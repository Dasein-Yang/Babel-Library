





# 2020 06 28 关于区块链的科普性笔记

伴随着P2P暴雷等等金融业务的信用崩溃和币圈孙宇晨这样的大佬们的频频走秀，区块链、比特币这些极富未来形态的名词在投资界近年却处在很微妙的境地——一边被资本热捧的热点和未来，一边又在民众严重打上了不靠谱和投机主义的tag。直到2019年的红头文件直接上升到国家金融战略的水准，相关的资本才开始雨后春笋般落地发芽。

去年十月份和四月份不务正业的时候读了几本区块链的书，抛开狂热的投机主义，对区块链稍作了解的人很难不为这套价值和信用体系感到惊叹：**它洞悉人性，把最纯粹的利益作为公信体系的驱动力，把信任交给永不撒谎的加密算法和算力；它知晓每一笔交易的来去，却允许身份隐于庞大网络之中；它富有强烈的geek精神，信奉分布与独立，不服从于任何一个国家、机构，打造算法式民主的理想社会；它的创始人从未现身于江湖，却在一个江湖中被封为上帝。**

我充分相信，这套基于加密算法和价值互联的信用体系会从一套技术的符号和概念变成一系列触手可及的，它也许会经历几次热捧和跌落，会缔造新的传奇也会制造新的泡沫，但最终必将深远地改变每一个像我一样的普通人习以为常的生活模式。

这些词汇太遥远也太宏大，那其中将出现的浪潮、机遇时常令我眼睛发亮，但我也知道，一切仍在酝酿之中，而我的时代还没有到来，在此之前我仅仅想以科普博客的方式记录我的新知，锻炼逻辑表达能力和语言总结之用，非专业人士毫无相关，写的非常浅显，但是会尽可能把信息串联成一张合理之网，启迪自己找到寻觅趋势的感觉，找到正确的投资和研究逻辑。

## 价值 与 信息

如果说过去几十年究竟如何带来了我们的生活模式带来巨大改变，可以看到各行各业的两类巨大变革发生的趋势（可能有很多类），一条是信息化，众多商业模式的创新本质仍是从古有之的行业和功能，信息壁垒的打破催生了现有的所有行业寡头，电商、通讯工具、交通、外卖。另一条是自动化，用大规模理性化、程式化逐步取代非理性、灵活化的东西来提高效率，法律替代父母官，计算机程序替代人工，算法和数据替代估测和随机。

但是在信息化和自动化的过程中，价值（或信用）的盲点却始终没有突破，尽管互联网也对金融起到了一定程度的变革，线上交易、数字金融等等，但金融由于与货币法律经济制度相连，信用与人性相连，其本质并未得到任何改变。这是因为从底层原理上，信息和价值的传播的途径和需求就不一致，信息是基于复制传播，而价值则基于总量守恒（有通货膨胀）的原则，信息交换可以1+1>2，而价值交换却要经过复杂的验证确保1+1=2。

在最原始的生活体系中，人类作为一个社会生存而非个体，最主要的利益交换只有两种，价值交换与信息交换，今天一切也不例外。工作的本质是价值交换，通过劳动力交换金钱，金钱交换生活资料，这样的循环就是度过我们的一生。商业时代的交易本质仍是价值交换或信息交换，大多数实体经济属于前者，虚拟经济属于后者。在价值交换中的自动化，契约精神、报表和财务等办公自动化似乎对原有的价值交换有所升级，但在金融、法律、经济和人性的交界处，价值交换仍然壁垒高筑：银行保险等行业的信用和价值问题，等等。

技术的革新就发生在“需求”和“当下”的矛盾之间，构建适合于信用难题和价值交换的基础架构的需求呼之欲出。

## 中心化 与 去中心化

仍然对比互联网媒介的发展趋势，从中心化的信息来源转变为非中心化的。（当然这一说法并不确切，即使是当前的网络仍然是小聚集、大分布的，在意见表达的小群落中人们仍然共同连接部分关键网络节点，称之为局部中心化可能更合适）[TODO:查询传播学是否有与之对应的理论]

今天的价值体系也是中心化的：几乎每个国家都是如此，中心化的机构发行货币，分散化地在节点间流通，而一些大型节点（银行、券商基金）连接着大部分节点，总的来说仍是中心化的网络。

中心化网络的关键问题是中心化节点的信用，在过去，报纸媒介的谎言后果不可估量，比如盛极一时的气功，所以中心节点的可信度一般都极高，但节点之间的壁垒不可想象，小道消息、道听途说、乡野怪谈盛行于过去的时代绝不仅仅是知识普及率的原因。在互联网体系中，分布化的节点则是高度冗余、交叉验证、同时又鱼龙混杂，使得罗生门式的众生相尽显，而对于个体而言，哪怕从奥威尔式的世界变成赫胥黎的世界，信息壁垒的打通总归是进步的。

对应在价值网络上，中心节点信用倒不至于破产，但轻微的通货膨胀、汇率变动、金融霸权也就够国民受的了，布雷顿森林体系[TODO：仔细研究一下] 可以把近几十年某个国家的经济危机和压力转移到全球，通货膨胀更是很多人一生努力都追不上，中心化体系的信用问题会成为未来的核心问题。

## 信任 与 利益

与传统信息壁垒对应，价值壁垒的存在也有类似的混乱，不同国家经济体系千差万别。即便欧盟之间文化相似、经济体量相似的相邻国家，几十年的并轨经济互惠中，虽短期尝到红利，长期来看却步伐不一、危机四伏，渐渐也有了分崩离析之态。国际贸易中仅关税一项。更何况世界各国间进行经济合作的信任关系。

假币、黑色产业、非法交易、贪污受贿，当我们只有一盏光源，就总存在光源之外的角落，存在中心化投射的阴影。

分布式价值网络应运而生。

## taxmony

### 供应、交易与安全

货币的三个维度。

供应机制：分布式网络、算力和矿产（激励机制）

交易机制：基于时间戳的区块链、共识机制

安全机制：51%攻击与非对称加密算法

### 区块链模型

类比于互联网的OSI模型，区块链网络和社会也可以划分为自底向上的六层模型。

1.  数据层：封装了数据块的链式结构、timestamp技术和非对称加密算法。
2.  网络层：维护区块链的节点 P2P 网络，以及数据传播和验证机制。 
3.  共识层：封装共识 (confirm) 机制协议的算法，典型的共识机制如Pos, Pow, Dpos.
4.  激励层：封装结合社会经济激励 (incentive) 的发行和分配机制。
5.  合约层：重点是智能合约，可编程货币 (programmable block/currency) 和算法脚本
6.  应用层：顶层应用场景，如医疗、金融、慈善、政府部门等具体区块链应用。

前三层是纯粹的区块链技术部分，核心目的即如何构建一个共同维护庞大数据体系的分布式网络，后三层则不同程度地结合了社会经济体系、个体趋利本性、商业社会的契约文化，随不同的应用场景变化而变化。

### 数据层

核心机制在于非对称加密和时间戳技术。

#### 时间戳技术

**区块**：最基本的区块包含自身哈希值，区块数据、前一个区块的哈希值和时间戳

**区块链**：从第一个头结点指向NULL的区块开始，每个区块具有独一无二的标识（哈希值）和不可修改的时间戳，通过指针（前一个区块的哈希值）缀连起来成为一条链。

```python
def make_a_block(index,timestamp,data,previous_hash):
        block={}
        block["index"]=index
        block["timestamp"]=timestamp
        block["data"]=data
        block["previous_hash"]=previous_hash
        block["hash"]=hash(index,data,timestamp,previous_hash)
        return block
```



#### 非对称加密

加密技术的核心： 原文A x 密钥Key（通过某种加密算法） = 密文B

-   最简单的加密算法，如乘法乘上密钥key得到B，即可以通过除法由B和密钥得到A，加密方法和解密方法是互逆的。

-   **单向加密**即加密容易，解密很难。这种算法特点是正向运算 $A = F(B)$ 计算量小而 $B=F^{-1}A$ 难，并且满足密文的唯一性，如哈希算法。单向加密有一定信息损失，不能用于信息传输，但可以用于传输结果准确性验证，如MD5验证，BT下载通过哈希算法确认正确性。

-   **非对称加密**可以理解为更高要求的单向加密，加密和解密使用两把密钥使用A加密得到$B = F(A,K1)$，但是解密$A = F^{-1}(B,K2)$。K1为公钥，K2为密钥。

    举例来说：任何一个数字x 400 000 001（=19801x20201)，末八位不变，因此 K1=19801 作为公钥，K2 = 20201作为密钥，持有K1公钥的人发送信息 A ，x K1 得到的密文B可以公开传播，但只有拥有 K2 密钥的人收到 B  , x K2 才能得到原文。

**如何用在比特币中？**

在比特币交易的P2P网络中，A要证明给B的信息是自己发出的，只能有两个步骤，用A的私钥做第一层加密（数字签名），抱枕A发出，B的公钥做第二层加密，保证只有B解开。B用自己私钥解密第一层，再用A公钥解密第二层。

发出者公钥加密，确保了消息来源真实性，收到者用私钥执行解密，确保了隐私性。比特币地址即公钥，大家都可以用于加密，钱包文件即私钥。地址数量相当大，基本不可能重合。

**符合要求的非对称加密算法？RSA算法和ECC算法**

大数分解、离散对数和椭圆曲线等问题，公认消耗计算量极大，正向运算很容易，反向运算很难。

椭圆曲线即比特币体系中的安全算法，安全性能更高，计算量小，处理速度快，存储空间小，带宽要求低。

### 网络层

区块链的去中心化主要体现在网络层。对比中心化金融时代，人与人的交易转账必须最终通过银行账目上完成，通过现金的交易看似由个人交付个人，货币的发行和收回仍是中心化的。而区块链则由无数个分布式节点组成，节点与节点等同，交易中直接点对点完成交换，并记录在全球公有可以无限追溯的账本（区块链）上。这种分布式系统的冗余度几乎达到100%，只要还剩下一台电脑存储了该记录，区块链就永远可以追溯有史以来的所有交易。

P2P组网技术已经非常成熟，电驴种子下载就是典型的应用，网络层主要解决以下问题：

1.  数据如何传播？如何让交易单被大家知晓？
2.  数据如何验证？如何确认交易有效？

### 共识层

共识层的核心问题即 : 谁来记账?

比较自然的几种思路无非是，多劳者居之(Pow)，富者居之(Pos)，能者居之(DPos)。

| 机制                | 记账权         | 主体         | 备注       | 好坏                                                         |
| ------------------- | -------------- | ------------ | ---------- | ------------------------------------------------------------ |
| 工作量证明机制(PoW) | 算力           | 开发者、矿工 | 淘金时代   | 1. 大量消耗资源<br />2. 公平、去中心化<br />3. 掌握该网络很难(51% 攻击) |
| 权益证明机制(PoS)   | 财富           | 持币者       | 股东分红   | 1. 正向激励的闭环系统<br />2. 贫富差距                       |
| 股份授权证明(DPoS)  | 持币者投票选举 | 选举者       | 董事会制度 | 1. 正向激励的闭环系统<br />2. 效率最高                       |

工作量证明机制(PoW)：通过算力决定记账权，类比于淘金时代。工作量即通过大量运算(试错)得到一个易于验证的结果(计算新区块的hash值)，在比特币网络中称之为挖矿，发现概率与算力成正比。一方面大量运算消耗资源，另一方面也维护了安全性，在这种机制下要占有区块链至少需要达到全网51%的算力（51%攻击），而现今能够达到这一算力，举国之力也非常难。

权益证明机制(PoS)：通过持有币数决定记账权。类比于现实中的股东分红，大股东会主动维护区块链的安全性。

股份授权证明(DPoS)：通过持有币的人投票决定委托人，类比于董事会制度，一方面持有者在体系中具有话语权，会主动维护体系的安全，另一方面记账人数量可控，效率更高。

### 区块链类型

区块链按照作用域、节点权限（记账、查看）、维护机制可以分为以下几种。

| 链     | 权限       | 作用域        | 维护机制  |
| ------ | ---------- | ------------- | --------- |
| 公有链 | 全部等同   | 全公开        | 代币奖励  |
| 私有链 | 等同/不同  | 公司、组织内  | 工作职责  |
| 联盟链 | 记账者指定 | 联盟者        | 联盟合约  |
| 混合链 | 不同       | 全公开/组织内 | 奖励/工作 |
| 许可链 | 不同       | 获取许可者    | 奖励/工作 |



公有链即完全公开的区块链，所有用户权限等同，无监督运行。通过代币产生的经济效益激励，和PoS和PoW等共识机制运行维护，形成闭环系统，没有人能够干涉。

私有链可能存在于公司、政府等部门数据公开的需要，无考虑激励机制。

联盟链则是记账者已经预先选定的可控公有链，如R3 CEV，由15个银行节点组成。

混合链包含范围很广，比如以上的联盟链私有链，节点权限不同，奖励机制不同，属于广义的区块链应用。

### 智能合约

类似一段价值网络中的 `if else` 语句，自动执行合约条款，代码即法律。

能最大程度地降低信任成本，但是代码一定执行，绝对不能中止/

## 问题

1.  如何在网络非常庞大的情况下全网广播？如何解决谁先到达的问题？
2.  每台电脑存储全网数据，存储量有多大？
3.  如何称之为接入比特币网络？拥有一个钱包文件？还是拥有

